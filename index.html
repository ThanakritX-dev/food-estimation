<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Image Difference Analyzer</title>

<style>
body{
    font-family:Arial;
    background:linear-gradient(135deg,#667eea,#764ba2);
    padding:20px;
    text-align:center;
}

.container{
    background:white;
    max-width:900px;
    margin:auto;
    padding:20px;
    border-radius:20px;
    box-shadow:0 15px 30px rgba(0,0,0,0.3);
}

button{
    padding:10px 15px;
    margin:5px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-weight:bold;
}

.blue{background:#2196F3;color:white;}
.green{background:#4CAF50;color:white;}
.red{background:#f44336;color:white;}
.orange{background:#ff9800;color:white;}

video,img,canvas{
    width:100%;
    border-radius:10px;
    margin-top:10px;
}

.compare{
    display:flex;
    gap:15px;
    margin-top:15px;
}

.compare div{
    flex:1;
}

.label{
    font-weight:bold;
    margin-top:10px;
}

.result{
    margin-top:15px;
    font-size:18px;
    font-weight:bold;
}
</style>
</head>
<body>

<h1>üî• Advanced Image Difference Analyzer</h1>

<div class="container">

<button class="blue" onclick="startCamera()">üì∑ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
<button class="blue" onclick="switchCamera()">üîÑ ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
<button class="green" onclick="captureBefore()">üì∏ ‡∏ñ‡πà‡∏≤‡∏¢ BEFORE</button>
<button class="green" onclick="captureAfter()">üì∏ ‡∏ñ‡πà‡∏≤‡∏¢ AFTER</button>

<br><br>

‡πÄ‡∏•‡∏∑‡∏≠‡∏Å BEFORE:
<input type="file" accept="image/*" onchange="uploadBefore(event)">
<br>
‡πÄ‡∏•‡∏∑‡∏≠‡∏Å AFTER:
<input type="file" accept="image/*" onchange="uploadAfter(event)">

<video id="video" autoplay playsinline></video>

<div class="compare">
<div>
<div class="label">BEFORE</div>
<img id="beforeImg">
</div>

<div>
<div class="label">AFTER</div>
<img id="afterImg">
</div>
</div>

<button class="red" onclick="calculateDifference()">üßÆ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
<button class="orange" onclick="toggleHeatmap()">üå° Toggle Heatmap</button>

<div class="result" id="resultText"></div>

<div class="label">Difference Map</div>
<canvas id="diffCanvas"></canvas>

</div>

<script>
let video=document.getElementById("video");
let beforeImg=document.getElementById("beforeImg");
let afterImg=document.getElementById("afterImg");
let resultText=document.getElementById("resultText");
let diffCanvas=document.getElementById("diffCanvas");
let heatmapMode=false;

let currentStream;
let facingMode="environment";

async function startCamera(){
if(currentStream){
currentStream.getTracks().forEach(track=>track.stop());
}
currentStream=await navigator.mediaDevices.getUserMedia({
video:{facingMode:facingMode}
});
video.srcObject=currentStream;
}

function switchCamera(){
facingMode=(facingMode==="environment")?"user":"environment";
startCamera();
}

function captureBefore(){
let canvas=createCanvasFromVideo();
beforeImg.src=canvas.toDataURL();
}

function captureAfter(){
let canvas=createCanvasFromVideo();
afterImg.src=canvas.toDataURL();
}

function createCanvasFromVideo(){
let canvas=document.createElement("canvas");
canvas.width=video.videoWidth;
canvas.height=video.videoHeight;
let ctx=canvas.getContext("2d");
ctx.drawImage(video,0,0);
return canvas;
}

function uploadBefore(event){
let reader=new FileReader();
reader.onload=e=>beforeImg.src=e.target.result;
reader.readAsDataURL(event.target.files[0]);
}

function uploadAfter(event){
let reader=new FileReader();
reader.onload=e=>afterImg.src=e.target.result;
reader.readAsDataURL(event.target.files[0]);
}

function toggleHeatmap(){
heatmapMode=!heatmapMode;
alert("Heatmap: "+(heatmapMode?"ON":"OFF"));
}

function calculateDifference(){
if(!beforeImg.src || !afterImg.src){
alert("‡πÉ‡∏™‡πà BEFORE ‡πÅ‡∏•‡∏∞ AFTER ‡∏Å‡πà‡∏≠‡∏ô");
return;
}

let img1=new Image();
let img2=new Image();
img1.src=beforeImg.src;
img2.src=afterImg.src;

img1.onload=function(){
img2.onload=function(){

let width=Math.min(img1.width,img2.width);
let height=Math.min(img1.height,img2.height);

diffCanvas.width=width;
diffCanvas.height=height;

let ctx=diffCanvas.getContext("2d");

let tempCanvas=document.createElement("canvas");
tempCanvas.width=width;
tempCanvas.height=height;
let tempCtx=tempCanvas.getContext("2d");

tempCtx.drawImage(img1,0,0,width,height);
let data1=tempCtx.getImageData(0,0,width,height);

tempCtx.drawImage(img2,0,0,width,height);
let data2=tempCtx.getImageData(0,0,width,height);

let diffData=ctx.createImageData(width,height);

let diffPixels=0;
let totalPixels=width*height;

for(let i=0;i<data1.data.length;i+=4){

let rDiff=Math.abs(data1.data[i]-data2.data[i]);
let gDiff=Math.abs(data1.data[i+1]-data2.data[i+1]);
let bDiff=Math.abs(data1.data[i+2]-data2.data[i+2]);

let diff=rDiff+gDiff+bDiff;

if(diff>60){
diffPixels++;

if(heatmapMode){
diffData.data[i]=diff;
diffData.data[i+1]=0;
diffData.data[i+2]=255-diff;
}else{
diffData.data[i]=255;
diffData.data[i+1]=0;
diffData.data[i+2]=0;
}

diffData.data[i+3]=255;
}else{
diffData.data[i]=0;
diffData.data[i+1]=0;
diffData.data[i+2]=0;
diffData.data[i+3]=255;
}
}

ctx.putImageData(diffData,0,0);

let percent=((diffPixels/totalPixels)*100).toFixed(2);

resultText.innerHTML=
"‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô: "+percent+" %";
}
}
}
</script>

</body>
</html>

