<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Food Loss Calculator</title>
<style>
body { font-family: Arial; text-align: center; margin-top: 20px; }
video, canvas, img { max-width: 280px; margin: 10px; border: 1px solid #ccc; }
button { padding: 8px 12px; margin: 5px; }
</style>
</head>
<body>

<h2>‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢‡πÑ‡∏õ</h2>

<h3>üì∏ ‡∏Å‡∏•‡πâ‡∏≠‡∏á</h3>
<video id="video" autoplay></video><br>
<button onclick="captureBefore()">‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏¥‡∏ô</button>
<button onclick="captureAfter()">‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏¥‡∏ô</button>

<hr>

<h3>üñº ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</h3>
‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏¥‡∏ô (100%) :
<input type="file" accept="image/*" onchange="loadBefore(event)"><br><br>

‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏¥‡∏ô :
<input type="file" accept="image/*" onchange="loadAfter(event)">

<br><br>
<button onclick="compareImages()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>

<h3 id="result"></h3>

<canvas id="beforeCanvas" style="display:none;"></canvas>
<canvas id="afterCanvas" style="display:none;"></canvas>

<script>
const video = document.getElementById("video");

// ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
if (navigator.mediaDevices) {
  navigator.mediaDevices.getUserMedia({ video: true })
  .then(stream => video.srcObject = stream)
  .catch(() => console.log("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ"));
}

function captureBefore() {
  saveFromVideo("beforeCanvas");
  alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß");
}

function captureAfter() {
  saveFromVideo("afterCanvas");
  alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß");
}

function saveFromVideo(canvasId) {
  const canvas = document.getElementById(canvasId);
  const ctx = canvas.getContext("2d");
  canvas.width = 300;
  canvas.height = 300;
  ctx.drawImage(video, 0, 0, 300, 300);
}

function loadBefore(event) {
  loadImageToCanvas(event, "beforeCanvas");
}

function loadAfter(event) {
  loadImageToCanvas(event, "afterCanvas");
}

function loadImageToCanvas(event, canvasId) {
  const file = event.target.files[0];
  const img = new Image();
  img.src = URL.createObjectURL(file);
  img.onload = function() {
    const canvas = document.getElementById(canvasId);
    const ctx = canvas.getContext("2d");
    canvas.width = 300;
    canvas.height = 300;
    ctx.drawImage(img, 0, 0, 300, 300);
  }
}

function compareImages() {
  const beforeCanvas = document.getElementById("beforeCanvas");
  const afterCanvas = document.getElementById("afterCanvas");

  if (!beforeCanvas.width || !afterCanvas.width) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô");
    return;
  }

  const beforeData = beforeCanvas.getContext("2d")
      .getImageData(0, 0, 300, 300).data;

  const afterData = afterCanvas.getContext("2d")
      .getImageData(0, 0, 300, 300).data;

  let diffPixels = 0;
  let totalPixels = 300 * 300;

  for (let i = 0; i < beforeData.length; i += 4) {
    let rDiff = Math.abs(beforeData[i] - afterData[i]);
    let gDiff = Math.abs(beforeData[i+1] - afterData[i+1]);
    let bDiff = Math.abs(beforeData[i+2] - afterData[i+2]);

    let diff = (rDiff + gDiff + bDiff) / 3;

    if (diff > 30) {
      diffPixels++;
    }
  }

  let percentLost = (diffPixels / totalPixels) * 100;
  let percentRemain = 100 - percentLost;

  document.getElementById("result").innerHTML =
      "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: " + percentLost.toFixed(1) + "%<br>" +
      "‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: " + percentRemain.toFixed(1) + "%";
}
</script>

</body>
</html>